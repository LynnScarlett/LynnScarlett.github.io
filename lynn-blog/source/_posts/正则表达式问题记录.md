---
title: 正则表达式问题记录
date: 2019-03-14 21:28:10
tags:
  - Tips
categories:
  - JavaScript
---

# 正则表达式问题记录

## Q1: 为什么正则表达式 第一次为 true，第二次为 false

示例:

```js
let reg = new RegExp(/abc/gi)
reg.test("abc ") // true
reg.test("abc ") // false
```

这个问题的产生原因是：当有全局匹配标记时，每个正则表达式都有 lastIndex 属性，记录下一次匹配的位置，匹配过一次之后 lastIndex 没有归零。

以下是[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/lastIndex)对于 lastIndex 的解释：

> 只有正则表达式使用了表示全局检索的 "g" 标志时，该属性才会起作用。此时应用下面的规则：
>
> - 如果 lastIndex 大于字符串的长度，则 regexp.test 和 regexp.exec 将会匹配失败，然后 lastIndex 被设置为 0。
> - 如果 lastIndex 等于字符串的长度，且该正则表达式匹配空字符串，则该正则表达式匹配从 lastIndex 开始的字符串。（then the regular expression matches input starting at lastIndex.）
> - 如果 lastIndex 等于字符串的长度，且该正则表达式不匹配空字符串 ，则该正则表达式不匹配字符串，lastIndex 被设置为 0.。
> - 否则，lastIndex 被设置为紧随最近一次成功匹配的下一个位置。

解决办法：

1. 去掉`g`标志;
2. 在每次匹配之后将`reg`的`lastIndex`置 0。

_此文不定期更新，用于记录_
